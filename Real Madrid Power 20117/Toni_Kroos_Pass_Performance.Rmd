---
title: "Kroos_Performance"
author: "Victor Ayala"
date: "20/9/2020"
output: html_document
---

Se analiza la posición de los pases realizados por T. Kroos contra el Celta de Vigo, jugando el Real Madrid en casa el 2018-05-12.

Cargamos librerias

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(jsonlite)
library(ggsoccer)
```



```{r, cache}
matches <- fromJSON("data/matches/matches_Spain.json", flatten = TRUE)
players <- read.csv("data/Real_Madrid_Players.csv")
eventos <- fromJSON("data/eventos_real_madrid.json")
```

 

```{r}
#Buscamos el ID de T. Kroos

players <- as_tibble(players[c("shortName", "wyId")])
players[12:15,1:2]
```

```{r}

#Nos quedamos con los eventos del jugador

eventos <- eventos %>%
  filter(playerId == "14723")

#Nos quedamos con los pases
pases <-eventos %>%
  filter(eventName %in% c("Pass"))

#Elegimos el partido contra el Celta

pases_contra_celta <- pases %>%
  filter(matchId == 2565912)

```


## Para extraer la posición del evento (viene anidada) utilicé la función de Ismael Gomez ![link](https://github.com/Dato-Futbol/xg-model/blob/master/getshots.R) 

```{r, warning=FALSE}

### Tomo los eventos del primer tiempo

primer_tiempo <- pases_contra_celta %>%
  filter(pases_contra_celta$matchPeriod =="1H") 
  
coordenadas <- tibble(positions = primer_tiempo$positions) %>%
  hoist(positions, 
        y = "y",
        x = "x") %>%
  unnest_wider(y, names_sep = "") %>%
  unnest_wider(x, names_sep = "") %>%
  dplyr::select(-positions) %>%
  rename_at(vars(contains(".")), funs(gsub("...", "_", ., fixed = TRUE))) #%>%
  #dplyr::select(-c(x_2, y_2))
```


```{r}
ggplot(coordenadas)   + 
  annotate_pitch(colour = "white" , fill = "#7fc47f", limits = FALSE) + theme_pitch() + geom_point(aes(x = x_1, y = y_1))
```

